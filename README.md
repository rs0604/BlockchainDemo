# BlockchainDemo
Python3 &amp; Flaskで動く、簡素なブロックチェーン

# 動作環境:
1. python 3.6以上 & pip
2. pip でFlaskとRequest libraryをインストール

```
pip install Flask==0.12.2 requests==2.18.4
```

3. jsonでリクエストを投げるため、Postmanをインストール

# 実行手順
## 1. サーバーの起動
```bash
$ python blockchain.py
```

サーバーが立ち上がると、「ジェネシスブロック」と呼ばれる、
ブロックチェーンの先頭部分が生成されます。

## 2. リクエスト
### 2.1 採掘

POSTMAN（cURLでも可）
http://localhost:5000/mine に GETリクエストを送信すると、採掘できます。

チェーン末尾に、新しいブロックを生成します。
この例では、ブロックの生成は「PoW(Proof of Work Algorithm)」に基づいて行われます。

#### Proof of ~ とは
Proof of ~ とは、「ブロックを追加する権利を決める仕組み」です。
具体的には、ハッシュ関数で探す値をどのように決めるかであり、
PoW以外にはコイン保有年数の長い人を優遇するアルゴリズムである「Proof of Stake」や、
予め決められた承認者の8割が承認すればブロックを生成できる「Proof of Concensus」などがあります。
PoWにおける「採掘」とは単純に、
「ハッシュ関数に代入すると、決められたルールでゼロが並ぶハッシュ値が得られる入力値(Nonce)を探す」
という条件なので、採掘者ごとの有利・不利はマシンパワーのみによって決まります。


#### ハッシュ値がどのようにセキュリティに寄与するのか
参考: https://coinotaku.com/?p=1235
Nonceは各ブロックに記録されており、あるブロックに紐づく取引を改ざんすると、
改ざん対象のブロック以前のすべてのNonceが条件を満たさなくなります。
過去のブロックすべてをマイニングするのと同等の労力がかかり、
その間に正当なブロックチェーンもどんどん長くなっていってるため、事実上改ざんは不可能です。


### 2.2 採掘したブロックに新しいトランザクションを作る
http://localhost:5000/transactions/new に POSTリクエストを送信する。

例)
```
{
  "sender": <採掘で取得したレスポンスのrecipientのハッシュ値>,
  "recipient": "someone-other-address",
  "amount": 5
}
```


### 2.3 採掘したブロックを取得する
http://localhost:5000/chain に GETリクエストを投げると、採掘済みのブロックをすべて取得できます。

## 3. コンセンサス：非中央集権的な、ブロックチェーン確認処理
インターネット上の全員が同じチェーンを反映していると確認するための方法。
（3.1, 3.2 は、ブロックチェーンの本質からは逸れるので、実際に動きを見ないのであれば読み飛ばしてください。）

### 3.1 ローカル上に、別のノードを追加する
shellを2つ立ち上げて、それぞれ -p オプションで異なるポート番号を指定し、ノードを立ち上げてください

ノードA
```
$python blockchain.py -p 5000
```

ノードB
```
$python blockchain.py -p 5001
```

### 3.2 双方のノードに、もう一方のノードを認識させる

ノードAに、ノードBを認識してもらいます
http://localhost:5000/nodes/register に、POSTリクエストを送信します。

```
{
	"nodes": ["http://127.0.0.1:5001"]
}
```
同じ要領でノードBにもリクエストを送信します。

これで、ローカル上に2箇所、互いにブロックチェーンのやりとりができるノードが確立されました。

### 3.3 ノード間に、チェーンの長さに差異をもたせる
mineリクエストを何度か送信し、ノードBのチェーンを長くしてみます。
```
http://127.0.0.1:5001/mine
```

※念のため/chain を両方に投げて、差異を確認してみましょう。

### 3.4 コンセンサスアルゴリズムによって、チェーンを置き換える
どちらか一方に、
```
http://127.0.0.1:5000/nodes/resolve
```

/chain で再度取得してみると、最長のチェーンがノード間でコピーされていることがわかるはずです。

# 参考サイト：
ブロックチェーンを作ることで学ぶ 〜ブロックチェーンがどのように動いているのか学ぶ最速の方法は作ってみることだ〜

https://qiita.com/hidehiro98/items/841ece65d896aeaa8a2a

Hackernoon: 上記Qiita投稿の翻訳元記事（英語）
https://hackernoon.com/learn-blockchains-by-building-one-117428612f46

CoinOtaku:プルーフオブワーク（PoW）の仕組みとは？プルーフオブステークとの違いも説明します！
https://coinotaku.com/?p=1235

CoinOtaku:Proof of Stake（PoS）とは？仕組みやデメリット、イーサリアムの移行予定など
https://coinotaku.com/?p=1302

POSTMAN: REST APIテストツール
https://www.getpostman.com/

Flask: Python用 軽量Webアプリケーションフレームワーク
https://a2c.bitbucket.io/flask/


# TODO:
改ざん用APIを用意する
